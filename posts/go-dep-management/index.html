<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Go Modules是Go 语言从 1.11 版本之后官方推出的版本管理工具。1.11+以后默认GO111MODULE=auto，只要当前目录在$GOPAT"><meta name=keywords content=","><title>Go Dep Management</title>
<link rel=canonical href=https://theoriz0.github.io/posts/go-dep-management/><link rel=stylesheet href=/scss/style.min.abbd69b2908fdfcd5179898beaafd374514a86538d81639ddd2c58c06ae54e40.css><meta property="og:title" content="Go Dep Management"><meta property="og:description" content="Go Modules是Go 语言从 1.11 版本之后官方推出的版本管理工具。1.11+以后默认GO111MODULE=auto，只要当前目录在$GOPAT"><meta property="og:url" content="https://theoriz0.github.io/posts/go-dep-management/"><meta property="og:site_name" content="theoriz0's blog"><meta property="og:type" content="article"><meta property="article:section" content="Posts"><meta property="article:tag" content><meta property="article:tag" content><meta property="article:published_time" content="2023-11-09T18:07:39+08:00"><meta property="article:modified_time" content="2023-11-09T18:07:39+08:00"><meta name=twitter:title content="Go Dep Management"><meta name=twitter:description content="Go Modules是Go 语言从 1.11 版本之后官方推出的版本管理工具。1.11+以后默认GO111MODULE=auto，只要当前目录在$GOPAT"><script async src="https://www.googletagmanager.com/gtag/js?id=G-8HN1FE064R"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-8HN1FE064R",{anonymize_ip:!1})}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><div class=site-meta><h1 class=site-name><a href=/>theoriz0's blog</a></h1><h2 class=site-description></h2></div></header><ol class=menu id=main-menu><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ul><li><a href=#gomod>go.mod</a><ul><li><a href=#go-mod命令><code>go mod</code>命令</a></li><li><a href=#gomod关键字>go.mod关键字</a></li></ul></li><li><a href=#gosum>go.sum</a></li><li><a href=#version的确定规则><code>version</code>的确定规则</a></li><li><a href=#gowork>go.work</a><ul><li></li></ul></li><li><a href=#参考文档>参考文档</a></li></ul></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/posts/go-dep-management/>Go Dep Management</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Nov 09, 2023</time></div></footer></div></header><section class=article-content><p><code>Go Modules</code>是Go 语言从 1.11 版本之后官方推出的<strong>版本管理</strong>工具。1.11+以后默认<code>GO111MODULE=auto</code>，只要当前目录在<code>$GOPATH/src</code>之外且该目录包含go.mod文件就会使用<code>Go Modules</code>。</p><p>使用modules依赖管理后：</p><ul><li>不需要将代码再放入$GOPATH/src</li><li>对于已经转移的包，可以用replace在go.mod文件中替换，不需要修改代码</li></ul><p>当modules 功能启用时，依赖包的存放位置为<code>$GOPATH/pkg</code>，允许同一个package多个版本并存，且多个项目可以共享缓存的 module。</p><h2 id=gomod>go.mod</h2><h3 id=go-mod命令><code>go mod</code>命令</h3><div class=table-wrapper><table><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td>download</td><td>download modules to local cache(下载依赖包到本地缓存)</td></tr><tr><td>edit</td><td>edit go.mod from tools or scripts (编辑go.mod)</td></tr><tr><td>graph</td><td>print module requirement graph (打印模块依赖图)</td></tr><tr><td>init</td><td>initialize new module in current directory (在当前目录初始化go.mod)</td></tr><tr><td>tidy</td><td>add missing and remove unused modules(拉取缺少的模块，移除不用的模块)</td></tr><tr><td>vendor</td><td>make vendored copy of dependencies(将依赖复制到vendor下)</td></tr><tr><td>verify</td><td>verify dependencies have expected content (验证依赖是否正确)</td></tr><tr><td>why</td><td>explain why packages or modules are needed(解释为什么需要依赖)</td></tr></tbody></table></div><p>执行 <code>go get</code>命令，在下载依赖包的同时还可以指定依赖包的版本</p><ul><li>运行<code>go get -u</code>命令会将项目中的包升级到最新的次要版本或者修订版本</li><li>运行<code>go get -u=patch</code>命令会将项目中的包升级到最新的修订版本</li><li>运行<code>go get [包名]@[版本号]</code>命令会下载对应包的指定版本或者将对应包升级到指定的版本</li></ul><p>当然我们也可以先不<code>go get</code>，在最后<code>go run main.go</code>时，<code>go.mod</code>同样会自动查找依赖自动下载</p><h3 id=gomod关键字>go.mod关键字</h3><div class=table-wrapper><table><thead><tr><th>命令字</th><th>作用</th></tr></thead><tbody><tr><td>module</td><td>指定包的名字（路径）</td></tr><tr><td>require</td><td>指定依赖项模块</td></tr><tr><td>replace</td><td>替换依赖项模块</td></tr><tr><td>exclude</td><td>忽略依赖项模块</td></tr></tbody></table></div><h2 id=gosum>go.sum</h2><p>go.sum就是依据hash来检测下载下来的依赖，是不是和该版本依赖复合</p><h2 id=version的确定规则><code>version</code>的确定规则</h2><p>一、项目是否打tag？</p><p>如果项目没有打 tag，会生成一个版本号，格式如下：<br>v0.0.0-commit日期-commitID</p><p>比如 <code>v0.0.0-20180321164747-3a771d992973</code>。</p><p>引用一个项目的特定分支，比如 develop branch，也会生成类似的版本号：<br>v当前版本+1-commit日期-commitID</p><p>比如 <code>v1.3.4-0.20191205000432-012d92843b00</code>。</p><p>二、项目有没有用 go module？</p><p>如果项目有用到 go module，那么就是正常地用 tag 来作为版本号。</p><p>比如 <code>github.com/DATA-DOG/go-sqlmock v1.3.3 h1:CWUqKXe0s8A2z6qCgkP4Kru7wC11YoAnoupUKFDnH08=</code>。</p><p>如果项目打了 tag，但是没有用到 go module，为了跟用了 go module 的项目相区别，需要加个 <code>+incompatible</code> 的标志。</p><p>比如 <code>github.com/google/martian v2.1.0+incompatible/go.mod h1:9I4somxYTbIHy5NJKHRl3wXiIaQGbYVAs8BPL6v8lEs=</code></p><p>三、项目用的 go module 版本是不是 v2+？</p><p>关于 go module v2+ 的特性，可以参考 Go 的官方文档：<a class=link href="https://link.juejin.cn/?target=https%3A%2F%2Fblog.golang.org%2Fv2-go-modules" title="https://link.juejin.cn?target=https%3A%2F%2Fblog.golang.org%2Fv2-go-modules" target=_blank rel=noopener>blog.golang.org/v2-go&mldr;</a>。简单而言，就是通过让依赖路径带版本号后缀来区分同一个项目里不同版本的依赖，类似于 <code>gopkg.in/xxx.v2</code> 的效果。</p><p>对于使用了 v2+ go module 的项目，项目路径会有个版本号的后缀。</p><p>比如 <code>github.com/googleapis/gax-go/v2 v2.0.5 h1:sjZBwGj9Jlw33ImPtvFviGYvseOtDM7hkSKB7+Tv3SM=</code></p><h2 id=gowork>go.work</h2><p>随着go 1.18版本的正式发布，多模块工作区也被引入（WorkSpaces），多模块工作区能够使开发者能够更容易地同时处理多个模块的工作， 如：方便进行依赖的代码调试(打断点、修改代码)、排查依赖代码 bug 。方便同时进行多个仓库/模块并行开发调试</p><h4 id=go-work支持命令><code>go work</code>支持命令</h4><ul><li><code>go work init</code> 初始化工作区文件，用于生成go.work工作区文件</li><li><code>go work use</code>添加新的模块到工作区</li></ul><blockquote><p>go work use ./example 添加一个模块到工作区</p><p>go work use ./example ./example1 添加多个模块到工作区</p><p>go work use -r ./example 递归./example目录到当前工作区</p><p>删除命令: go work edit -dropuse=./example功能</p></blockquote><ul><li><code>go work sync</code>将工作区的构建列表同步到工作区模块</li><li><code>go env GOWORK</code>查看环境变量，查看当前工作区文件路径，可以排查工作区文件是否设置正确，go.work路径找不到可以使用GOWORK指定</li></ul><h4 id=gowork文件结构>go.work文件结构</h4><p>go.work文件结构和go.mod文件结构类似，支持Go版本号、指定工作区和需要替代的仓库</p><p><code>use</code>指定使用的模块目录，可以使用<code>go work use</code>添加模块，也可以手动修改go.work工作区添加新的模块，在工作区中添加了模块路径，编译时会自动使用<code>use</code>中的本地代码进行编译</p><p><code>replaces</code>替换依赖仓库地址，<code>replaces</code>命令与go.mod指令相同，用于替换项目中依赖的仓库地址，需要注意的是，<code>replaces</code>和<code>use</code>不能同时指定相同的本地代码路径</p><h4 id=gowork文件优先级高于gomod>go.work文件优先级高于go.mod</h4><p>在同时使用go.work和go.mod的<code>replaces</code>功能时，分别指定不同的代码仓库路径，go.work优先级高于go.mod中定义</p><pre tabindex=0><code>//go.mod 中定义替换为本地仓库 example
replace ( 
    github.com/link1st/example =&gt; ./example 
)

//go.work 中定义替换为本地仓库 example1
replace ( 
    github.com/link1st/example =&gt; ./example1 
)
</code></pre><p>在代码构建时，使用的是go.work指定的example1仓库代码，go.work优先级别更高</p><p>使用go.work时，不同的项目文件必须在有同一个根目录， 推荐在<code>$GOPATH</code>路径下执行，生成go.work文件</p><h2 id=参考文档>参考文档</h2><p><a class=link href=https://juejin.cn/post/7182091980099289147 target=_blank rel=noopener>掘金文章</a></p><p><a class=link href=https://learnku.com/docs/go-mod/1.17 target=_blank rel=noopener>Go Modules官方文档</a></p></section><footer class=article-footer><section class=article-tags></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/posts/my-docker-cheatsheet/><div class=article-details><h2 class=article-title>My Docker Cheatsheet</h2></div></a></article><article><a href=/posts/my-private-clouds/><div class=article-details><h2 class=article-title>自有数据：我的私有云</h2></div></a></article><article><a href=/posts/large-scale-system-design/><div class=article-details><h2 class=article-title>系统设计面试指南（EN）</h2></div></a></article><article><a href=/posts/my-rclone-cos/><div class=article-details><h2 class=article-title>通过Rclone + 对象存储实现同步盘</h2></div></a></article><article><a href=/posts/my-git-cheatsheet/><div class=article-details><h2 class=article-title>My Git Cheatsheet</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//theoriz0blog.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2023 theoriz0's blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.21.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>