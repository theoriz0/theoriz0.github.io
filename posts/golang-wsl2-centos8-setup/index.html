<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="配置 WSL2 下 CentOS8 Go 语言开发环境。解决代理、内存、默认用户等问题。其他 Linux 发行版亦可参考。"><meta name=keywords content="WSL2,CentOS8,Go"><title>Golang WSL2 CentOS8 开发环境配置指南</title>
<link rel=canonical href=https://theoriz0.github.io/posts/golang-wsl2-centos8-setup/><link rel=stylesheet href=/scss/style.min.abbd69b2908fdfcd5179898beaafd374514a86538d81639ddd2c58c06ae54e40.css><meta property="og:title" content="Golang WSL2 CentOS8 开发环境配置指南"><meta property="og:description" content="配置 WSL2 下 CentOS8 Go 语言开发环境。解决代理、内存、默认用户等问题。其他 Linux 发行版亦可参考。"><meta property="og:url" content="https://theoriz0.github.io/posts/golang-wsl2-centos8-setup/"><meta property="og:site_name" content="theoriz0's blog"><meta property="og:type" content="article"><meta property="article:section" content="Posts"><meta property="article:tag" content="开发环境"><meta property="article:published_time" content="2023-01-11T22:32:58+08:00"><meta property="article:modified_time" content="2023-01-11T22:32:58+08:00"><meta name=twitter:title content="Golang WSL2 CentOS8 开发环境配置指南"><meta name=twitter:description content="配置 WSL2 下 CentOS8 Go 语言开发环境。解决代理、内存、默认用户等问题。其他 Linux 发行版亦可参考。"><script async src="https://www.googletagmanager.com/gtag/js?id=G-8HN1FE064R"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-8HN1FE064R",{anonymize_ip:!1})}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><div class=site-meta><h1 class=site-name><a href=/>theoriz0's blog</a></h1><h2 class=site-description></h2></div></header><ol class=menu id=main-menu><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ul><li><a href=#获取-wsl-centos8>获取 WSL CentOS8</a></li><li><a href=#安装并启动-centos8>安装并启动 CentOS8</a></li><li><a href=#设置-root-用户密码>设置 root 用户密码</a></li><li><a href=#创建普通用户并加入sudo组>创建普通用户并加入sudo组</a></li><li><a href=#替换-yum-源>替换 yum 源</a></li><li><a href=#修改-wsl-默认用户>修改 WSL 默认用户</a></li><li><a href=#获取-windows-主机网络地址>获取 Windows 主机网络地址</a></li><li><a href=#配置-homebashrc>配置 <code>$HOME/.bashrc</code></a><ul><li><a href=#配置clash或其他代理软件>配置clash或其他代理软件</a></li></ul></li><li><a href=#安装常用依赖>安装常用依赖</a></li><li><a href=#安装go环境>安装go环境</a><ul><li><a href=#安装protoc>安装protoc</a></li></ul></li><li><a href=#安装配置-docker>安装配置 Docker</a></li><li><a href=#创建默认-k8s-环境>创建默认 K8S 环境</a></li><li><a href=#其他>其他</a><ul><li><a href=#如果-wsl-占用内存过大>如果 WSL 占用内存过大</a></li><li><a href=#如果域名解析有问题>如果域名解析有问题</a></li><li><a href=#不建议关闭关闭自动创建-etcresolvconf>（不建议关闭）关闭自动创建 /etc/resolv.conf</a></li></ul></li></ul></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/posts/golang-wsl2-centos8-setup/>Golang WSL2 CentOS8 开发环境配置指南</a></h2><h3 class=article-subtitle>配置 WSL2 下 CentOS8 Go 语言开发环境。解决代理、内存、默认用户等问题。其他 Linux 发行版亦可参考。</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Jan 11, 2023</time></div></footer></div></header><section class=article-content><h2 id=获取-wsl-centos8>获取 WSL CentOS8</h2><p><a class=link href=https://github.com/mishamosher/CentOS-WSL target=_blank rel=noopener>mishamosher/CentOS-WSL</a></p><h2 id=安装并启动-centos8>安装并启动 CentOS8</h2><p>解压并运行<code>CentOS8.exe</code>。</p><p>Windows 命令行下运行：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>## 列出所有版本，确认 CentOS8 已安装成功</span>
</span></span><span style=display:flex><span>wsl --list
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## 如果有多个发行版，可以将默认版本设为 CentOS8</span>
</span></span><span style=display:flex><span>wsl -s CentOS8
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## 启动。如果设置了默认版本，可以忽略</span>
</span></span><span style=display:flex><span>wsl -d CentOS8
</span></span></code></pre></div><h2 id=设置-root-用户密码>设置 root 用户密码</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>passwd root
</span></span></code></pre></div><h2 id=创建普通用户并加入sudo组>创建普通用户并加入sudo组</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>useradd <span style=color:#f92672>[</span>username<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>passwd <span style=color:#f92672>[</span>username<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>sed -i <span style=color:#e6db74>&#39;/^root.*ALL=(ALL).*ALL/a\[username]\tALL=(ALL) \tALL&#39;</span> /etc/sudoers
</span></span></code></pre></div><h2 id=替换-yum-源>替换 yum 源</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mv /etc/yum.repos.d /etc/yum.repos.d.bak <span style=color:#75715e># 先备份原有的 Yum 源</span>
</span></span><span style=display:flex><span>mkdir /etc/yum.repos.d
</span></span><span style=display:flex><span>curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-vault-8.5.2111.repo
</span></span><span style=display:flex><span>yum clean all <span style=color:#f92672>&amp;&amp;</span> yum makecache
</span></span></code></pre></div><h2 id=修改-wsl-默认用户>修改 WSL 默认用户</h2><p>WSL 下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vi /etc/wsl.conf
</span></span></code></pre></div><p>文件内容为：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[user]
</span></span><span style=display:flex><span>default=[username]
</span></span></code></pre></div><p>保存后退出WSL，并在 Windows 下运行：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wsl --terminate CentOS8
</span></span></code></pre></div><p>重新启动 WSL，可以发现用户已经是所设置用户而不是root。</p><h2 id=获取-windows-主机网络地址>获取 Windows 主机网络地址</h2><p>WSL下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat /etc/resolv.conf |grep -oP <span style=color:#e6db74>&#39;(?&lt;=nameserver\ ).*&#39;</span>
</span></span></code></pre></div><p>尝试ping该地址。</p><p>如果不通，尝试在 Windows powershell 下放开 vEthernet (WSL) 这张网卡的防火墙，执行：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>New-NetFirewallRule -DisplayName <span style=color:#e6db74>&#34;WSL&#34;</span> -Direction Inbound -InterfaceAlias <span style=color:#e6db74>&#34;vEthernet (WSL)&#34;</span> -Action Allow
</span></span></code></pre></div><h2 id=配置-homebashrc>配置 <code>$HOME/.bashrc</code></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># .bashrc</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Source global definitions</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -f /etc/bashrc <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        . /etc/bashrc
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># User specific environment</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ! <span style=color:#f92672>[[</span> <span style=color:#e6db74>&#34;</span>$PATH<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span>~ <span style=color:#e6db74>&#34;</span>$HOME<span style=color:#e6db74>/.local/bin:</span>$HOME<span style=color:#e6db74>/bin:&#34;</span> <span style=color:#f92672>]]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    PATH<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$HOME<span style=color:#e6db74>/.local/bin:</span>$HOME<span style=color:#e6db74>/bin:</span>$PATH<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>export PATH
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Uncomment the following line if you don&#39;t like systemctl&#39;s auto-paging feature:</span>
</span></span><span style=display:flex><span><span style=color:#75715e># export SYSTEMD_PAGER=</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># User specific aliases and functions</span>
</span></span><span style=display:flex><span>alias rm<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;rm -i&#39;</span>
</span></span><span style=display:flex><span>alias cp<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;cp -i&#39;</span>
</span></span><span style=display:flex><span>alias mv<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;mv -i&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create workspace folder if not exist</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> ! -d $HOME/workspace <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    mkdir -p $HOME/workspace
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Basic envs</span>
</span></span><span style=display:flex><span>export LANG<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;en_US.UTF-8&#34;</span> <span style=color:#75715e># 设置系统语言为 en_US.UTF-8，避免终端出现中文乱码</span>
</span></span><span style=display:flex><span>export PS1<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;[\u@dev \W]$ &#39;</span> <span style=color:#75715e># 默认的 PS1 设置会展示全部的路径，为了防止过长，这里只展示：&#34;用户名@dev 最后的目录名&#34;</span>
</span></span><span style=display:flex><span>export WORKSPACE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$HOME<span style=color:#e6db74>/workspace&#34;</span> <span style=color:#75715e># 设置工作目录</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Default entry folder</span>
</span></span><span style=display:flex><span>cd $WORKSPACE <span style=color:#75715e># 登录系统，默认进入 workspace 目录</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Go envs</span>
</span></span><span style=display:flex><span>export GOVERSION<span style=color:#f92672>=</span>go1.19.4 <span style=color:#75715e># Go 版本设置</span>
</span></span><span style=display:flex><span>export GO_INSTALL_DIR<span style=color:#f92672>=</span>/usr/local/go <span style=color:#75715e># Go 安装目录</span>
</span></span><span style=display:flex><span>export GOROOT<span style=color:#f92672>=</span>$GO_INSTALL_DIR/$GOVERSION <span style=color:#75715e># GOROOT 设置</span>
</span></span><span style=display:flex><span>export GOPATH<span style=color:#f92672>=</span>$WORKSPACE/golang <span style=color:#75715e># GOPATH 设置</span>
</span></span><span style=display:flex><span>export PATH<span style=color:#f92672>=</span>$GOROOT/bin:$GOPATH/bin:$PATH <span style=color:#75715e># 将 Go 语言自带的和通过 go install 安装的二进制文件加入到 PATH 路径中</span>
</span></span><span style=display:flex><span>export GO111MODULE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;on&#34;</span> <span style=color:#75715e># 开启 Go moudles 特性</span>
</span></span><span style=display:flex><span>export GOPROXY<span style=color:#f92672>=</span>https://goproxy.cn,direct <span style=color:#75715e># 安装 Go 模块时，代理服务器设置</span>
</span></span><span style=display:flex><span>export GOPRIVATE<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>export GOSUMDB<span style=color:#f92672>=</span>off <span style=color:#75715e># 关闭校验 Go 依赖包的哈希值</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># proxy</span>
</span></span><span style=display:flex><span>alias proxy<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;source ~/proxy.sh&#34;</span>
</span></span><span style=display:flex><span>proxy set
</span></span></code></pre></div><h3 id=配置clash或其他代理软件>配置clash或其他代理软件</h3><p>详细可参考：<a class=link href=https://www.cnblogs.com/tuilk/p/16287472.html target=_blank rel=noopener>WSL2配置代理</a></p><p>开启代理软件的【allow lan/局域网】功能。</p><p>WSL 下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export ALL_PROXY<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://{ip}:{port}&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>## 尝试访问google</span>
</span></span><span style=display:flex><span>curl google.com
</span></span></code></pre></div><p>如果不通，检查 Windows 下 clash 防火墙设置。</p><p>如果成功，可以继续配置 <code>proxy.sh</code> 方便后续使用 ,修改代理端口号为你代理软件的端口号。</p><p>创建 <code>proxy.sh</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vi ~/proxy.sh
</span></span></code></pre></div><p>内容为：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/sh
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>hostip<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>cat /etc/resolv.conf | grep nameserver | awk <span style=color:#e6db74>&#39;{ print $2 }&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>wslip<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>hostname -I | awk <span style=color:#e6db74>&#39;{print $1}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>port<span style=color:#f92672>=</span><span style=color:#ae81ff>7890</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PROXY_HTTP<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://</span><span style=color:#e6db74>${</span>hostip<span style=color:#e6db74>}</span><span style=color:#e6db74>:</span><span style=color:#e6db74>${</span>port<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>set_proxy<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>  export http_proxy<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>PROXY_HTTP<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  export HTTP_PROXY<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>PROXY_HTTP<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  export https_proxy<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>PROXY_HTTP<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  export HTTPS_proxy<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>PROXY_HTTP<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  export ALL_PROXY<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>PROXY_SOCKS5<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  export all_proxy<span style=color:#f92672>=</span><span style=color:#e6db74>${</span>PROXY_SOCKS5<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  git config --global http.https://github.com.proxy <span style=color:#e6db74>${</span>PROXY_HTTP<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>  git config --global https.https://github.com.proxy <span style=color:#e6db74>${</span>PROXY_HTTP<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  echo <span style=color:#e6db74>&#34;Proxy has been opened.&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>unset_proxy<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>  unset http_proxy
</span></span><span style=display:flex><span>  unset HTTP_PROXY
</span></span><span style=display:flex><span>  unset https_proxy
</span></span><span style=display:flex><span>  unset HTTPS_PROXY
</span></span><span style=display:flex><span>  unset ALL_PROXY
</span></span><span style=display:flex><span>  unset all_proxy
</span></span><span style=display:flex><span>  git config --global --unset http.https://github.com.proxy
</span></span><span style=display:flex><span>  git config --global --unset https.https://github.com.proxy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  echo <span style=color:#e6db74>&#34;Proxy has been closed.&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ip<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>  echo <span style=color:#e6db74>&#34;WSL IP:&#34;</span> <span style=color:#e6db74>${</span>wslip<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>  echo <span style=color:#e6db74>&#34;Host IP:&#34;</span> <span style=color:#e6db74>${</span>hostip<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>test_setting<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>  echo <span style=color:#e6db74>&#34;Host IP:&#34;</span> <span style=color:#e6db74>${</span>hostip<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>  echo <span style=color:#e6db74>&#34;WSL IP:&#34;</span> <span style=color:#e6db74>${</span>wslip<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>  echo <span style=color:#e6db74>&#34;Try to connect to Google...&#34;</span>
</span></span><span style=display:flex><span>  resp<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>curl -I -s --connect-timeout <span style=color:#ae81ff>5</span> -m <span style=color:#ae81ff>5</span> -w <span style=color:#e6db74>&#34;%{http_code}&#34;</span> -o /dev/null www.google.com<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>${</span>resp<span style=color:#e6db74>}</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>200</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;Proxy setup succeeded!&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;Proxy setup failed!&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;set&#34;</span> <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>  set_proxy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>elif</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;unset&#34;</span> <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>  unset_proxy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>elif</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;test&#34;</span> <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>  test_setting
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>elif</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ip&#34;</span> <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>  ip
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>  echo <span style=color:#e6db74>&#34;Unsupported arguments.&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><p>使<code>.bashrc</code>生效</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>source ~/.bashrc
</span></span></code></pre></div><p>如果 yum 失败，可尝试关闭代理。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>proxy unset
</span></span></code></pre></div><h2 id=安装常用依赖>安装常用依赖</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo yum -y install git make autoconf automake cmake perl-CPAN libcurl-devel libtool gcc gcc-c++ glibc-headers zlib-devel git-lfs telnet lrzsz jq expat-devel openssl-devel openssl
</span></span></code></pre></div><h2 id=安装go环境>安装go环境</h2><p>（如果不需要 go 环境，可删去 .bashrc 的 GO 部分）</p><p>确认.bashrc的$GOVERSION，如果安装不同版本，修改之。</p><p>按照go官网下载go。<a class=link href=https://go.dev/dl/ target=_blank rel=noopener>Go官网下载地址</a></p><p>解压:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>rm -rf /usr/local/go <span style=color:#f92672>&amp;&amp;</span> tar -C /usr/local/go/$GOVERSION -xzf go1.19.4.linux-amd64.tar.gz
</span></span></code></pre></div><p>详见 <a class=link href=https://go.dev/doc/install target=_blank rel=noopener>Go官网安装指南</a>。</p><p>此时 go version应该能输出版本。</p><h3 id=安装protoc>安装protoc</h3><p>（最新版本在(github.com)[https://github.com/protocolbuffers/protobuf/releases)，可根据需要自行调整命令)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd /tmp/
</span></span><span style=display:flex><span>wget https://github.com/protocolbuffers/protobuf/releases/download/v21.9/protobuf-cpp-3.21.9.tar.gz
</span></span><span style=display:flex><span>tar -xvzf protobuf-cpp-3.21.9.tar.gz
</span></span><span style=display:flex><span>cd protobuf-3.21.9/
</span></span><span style=display:flex><span>./autogen.sh
</span></span><span style=display:flex><span>./configure
</span></span><span style=display:flex><span>make
</span></span><span style=display:flex><span>sudo make install
</span></span><span style=display:flex><span>protoc --version
</span></span></code></pre></div><p>在执行 autogen.sh 脚本时，如果遇到以下错误：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>configure.ac:48: installing &#39;./install-sh&#39;
</span></span><span style=display:flex><span>configure.ac:109: error: required file  &#39;./ltmain.sh&#39;  not found configure.ac:48: installing &#39;./missing&#39;
</span></span><span style=display:flex><span>benchmarks/Makefile.am: installing &#39;./depcomp&#39;
</span></span><span style=display:flex><span>conformance/Makefile.am:362: warning: shell python --version 2&gt;&amp;1: non-POSIX variable name
</span></span><span style=display:flex><span>conformance/Makefile.am:362: (probably a GNU make extension)
</span></span><span style=display:flex><span>conformance/Makefile.am:372: warning: shell python --version 2&gt;&amp;1: non-POSIX variable name
</span></span><span style=display:flex><span>conformance/Makefile.am:372: (probably a GNU make extension)
</span></span><span style=display:flex><span>parallel-tests: installing &#39;./test-driver&#39;
</span></span><span style=display:flex><span>autoreconf: automake failed with exit status: 1
</span></span></code></pre></div><p>可以通过以下命令配置 libtoolize，并再次运行 autogen.sh 来解决：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>libtoolize --automake --copy --debug --force
</span></span><span style=display:flex><span>./autogen.sh
</span></span></code></pre></div><h2 id=安装配置-docker>安装配置 Docker</h2><p>安装 docker desktop</p><p>检查 docker desktop 设置，确保：</p><ul><li><code>General - Use the WSL2 ...</code> 选中</li><li><code>Resource - WSL Integration：Enable integration...</code> 选中；指定的 WSL Distro（CentOS8）开关打开。</li></ul><p>如果报 <code>Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock</code>，可运行以下语句设置权限：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo setfacl --modify user:&lt;user name or ID&gt;:rw /var/run/docker.sock
</span></span></code></pre></div><p>(来源：<a class=link href=https://stackoverflow.com/questions/51342810/how-to-fix-dial-unix-var-run-docker-sock-connect-permission-denied-when-gro target=_blank rel=noopener>StackOverflow</a>)</p><p>如果报<code>failed to solve with frontend dockerfile.v0: failed to create LLB definition</code>，需在 docker desktop 中配置:</p><ul><li>docker engine: <code>"features": {"buildkit": false },</code></li></ul><p>并重新用<code>setfacl</code>设置权限</p><p>（来源：<a class=link href=https://blog.csdn.net/qq_41240287/article/details/125236997 target=_blank rel=noopener>CSDN</a>）</p><h2 id=创建默认-k8s-环境>创建默认 K8S 环境</h2><p>在 Docker Desktop 中设置：</p><ul><li>Kubernetes：勾选 Enable Kubernetes</li></ul><p>在 WSL 中检查 K8S 服务情况：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 关闭网络代理</span>
</span></span><span style=display:flex><span>proxy unset
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl version
</span></span><span style=display:flex><span>kubectl cluster-info
</span></span></code></pre></div><p>从 pod 中访问 WSL 资源时要使用 WSL 的 ip，而不是 localhost。获取方法：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>proxy ip
</span></span><span style=display:flex><span><span style=color:#75715e>## 或者</span>
</span></span><span style=display:flex><span>hostname -I | awk <span style=color:#e6db74>&#39;{print $1}&#39;</span>
</span></span></code></pre></div><h2 id=其他>其他</h2><h3 id=如果-wsl-占用内存过大>如果 WSL 占用内存过大</h3><p>在 Windows %UserProfile%目录下修改/新建 <code>.wslconfig</code>，内容为：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[wsl2]
</span></span><span style=display:flex><span>memory=4GB
</span></span></code></pre></div><p>注：goland WSL服务端 至少需要3.8GB内存</p><h3 id=如果域名解析有问题>如果域名解析有问题</h3><p>可以在/etc/resolv.conf添加</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span># aliyun dns
</span></span><span style=display:flex><span>nameserver 223.5.5.5
</span></span><span style=display:flex><span>nameserver 223.6.6.6
</span></span></code></pre></div><h3 id=不建议关闭关闭自动创建-etcresolvconf>（不建议关闭）关闭自动创建 /etc/resolv.conf</h3><p>不建议关闭，因为 proxy.sh 脚本通过读取该文件获取 WSL 下 Windows 的 host ip。</p><p>新建文件：/etc/wsl.conf，内容如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[network]generateResolvConf = false
</span></span></code></pre></div></section><footer class=article-footer><section class=article-tags><a href=/tags/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/>开发环境</a></section></footer></article><div class=disqus-container><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//theoriz0blog.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2023 theoriz0's blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.21.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>